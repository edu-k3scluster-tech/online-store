## How to run linters
```bash
make lint
```


## How to run tests

```bash
make test-order
```

## How to run project

```bash
make start
make stop
```

# üßæ –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: Event-driven Order System

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 3 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ **Kafka** –∏ –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ ‚Äî –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏.

**–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è:**
- **Order Service** —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka.  
- **Payment Service** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã, –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç –æ–ø–ª–∞—Ç—É (—É—Å–ø–µ—à–Ω–æ/–æ—à–∏–±–∫–∞), –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka.  
- **Shipping Service** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ–± —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–ª–∞—Ç–∞—Ö –∏ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–≥—Ä—É–∑–∫–∏.  
- **Order Service** —Å–ª—É—à–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞ –≤ –ë–î.  

–í—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Kafka. REST –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞.

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
                         +---------------------+
                         |      Order API      |
                         | (—Å–æ–∑–¥–∞–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å)  |
                         +---------+-----------+
                                   |
                         kafka ‚Üì   |   ‚Üë kafka
+---------------------+   +---------+-----------+   +---------------------+
|     Payment Service | ‚Üê |    Kafka Topics     | ‚Üí |   Shipping Service  |
| (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π)|   | orders, payments,   |   | (—Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≥—Ä—É–∑–∫–∏) |
|                     |   | shipments, cancels  |   |                     |
+---------------------+   +---------------------+   +---------------------+

- Order ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ "OrderCreated" –≤ `orders`
- Payment ‚Üí —Å–ª—É—à–∞–µ—Ç `orders`, –ø—É–±–ª–∏–∫—É–µ—Ç `payments` –∏–ª–∏ `cancels`
- Shipping ‚Üí —Å–ª—É—à–∞–µ—Ç `payments`, –ø—É–±–ª–∏–∫—É–µ—Ç `shipments`
- Order ‚Üí —Å–ª—É—à–∞–µ—Ç –≤—Å–µ —Ç–æ–ø–∏–∫–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
```

---

## ‚öôÔ∏è –ó–∞–¥–∞—á–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

### 1. üßæ Order Service
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- REST API:
  - `POST /orders` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (–≤ –ë–î, —Å—Ç–∞—Ç—É—Å `CREATED`)
  - `GET /orders/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `OrderCreated` –≤ Kafka (`orders`).
- –°–ª—É—à–∞–µ—Ç Kafka-—Ç–æ–ø–∏–∫–∏:
  - `payments` ‚Äî –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ `PAID`, –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ –ë–î –Ω–∞ `PAID`.
  - `shipments` ‚Äî –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ `SHIPPED`, –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ –ë–î –Ω–∞ `SHIPPED`.
  - `cancels` ‚Äî –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ `CANCELLED`, –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ –ë–î –Ω–∞ `CANCELLED`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Inbox Pattern**:
  - –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ Kafka-—Å–æ–æ–±—â–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `inbox` —Å `message_id`, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑).

---

### 2. üí≥ Payment Service
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Kafka-—Ç–æ–ø–∏–∫ `orders`.
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞:
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `inbox` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ:
    - –ï—Å–ª–∏ `orderId % 2 == 0` ‚Üí —Å–∏–º—É–ª–∏—Ä—É–µ—Ç **–æ—à–∏–±–∫—É –æ–ø–ª–∞—Ç—ã**, –ø—É–±–ª–∏–∫—É–µ—Ç `PaymentFailed` –≤ —Ç–æ–ø–∏–∫ `cancels`:
      ```json
      { "orderId": 2, "status": "CANCELLED", "reason": "INSUFFICIENT_FUNDS" }
      ```
    - –ï—Å–ª–∏ `orderId % 2 == 1` ‚Üí —Å–∏–º—É–ª–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É, –ø—É–±–ª–∏–∫—É–µ—Ç `PaymentSuccess` –≤ —Ç–æ–ø–∏–∫ `payments`:
      ```json
      { "orderId": 1, "status": "PAID", "amount": 150.0 }
      ```
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–º–µ–µ—Ç REST `GET /payments` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π.

---

### 3. üì¶ Shipping Service
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Kafka-—Ç–æ–ø–∏–∫ `payments`.
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `PaymentSuccess`:
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ `inbox` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).
  - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ–± –æ—Ç–≥—Ä—É–∑–∫–µ (–≤ –ë–î, —Å—Ç–∞—Ç—É—Å `SHIPPED`, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `trackingNumber`).
  - –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `OrderShipped` –≤ —Ç–æ–ø–∏–∫ `shipments`:
    ```json
    { "orderId": 1, "status": "SHIPPED", "trackingNumber": "SHIP-ABC123" }
    ```

---

## üß± –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Kafka —Ç–æ–ø–∏–∫–∏
| –¢–æ–ø–∏–∫ | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å | –ü–æ–ª—É—á–∞—Ç–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------------|-------------|----------|
| `orders` | Order Service | Payment Service | –°–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ |
| `payments` | Payment Service | Order & Shipping Service | –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–ª–∞—Ç—ã |
| `shipments` | Shipping Service | Order Service | –°–æ–±—ã—Ç–∏—è –æ–± –æ—Ç–≥—Ä—É–∑–∫–∞—Ö |
| `cancels` | Payment Service | Order Service | –û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã |

---

### Inbox Pattern (–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ–±—è–∑–∞–Ω:
- –ò–º–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É `inbox` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `id`, `message_id`, `payload`, `processed_at`).
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ Kafka-—Å–æ–æ–±—â–µ–Ω–∏—è:
  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ `message_id` –≤ `inbox`.
  2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.
  3. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (—Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ).

---

### Persistence
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ë–î –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ 
(–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –±–∞–∑—É –≤ –¥–æ–∫–µ—Ä–µ, —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã, 
—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —Å–µ—Ä–≤–∏—Å–∞):
- **Order Service** ‚Äî —Ç–∞–±–ª–∏—Ü—ã `orders`, `inbox`
- **Payment Service** ‚Äî —Ç–∞–±–ª–∏—Ü—ã `payments`, `inbox`
- **Shipping Service** ‚Äî —Ç–∞–±–ª–∏—Ü—ã `shipments`, `inbox`

---

## üöÄ –ö–∞–∫ —ç—Ç–æ –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

1. `POST /orders` ‚Üí —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ `#1`
   - Order Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–∫–∞–∑ ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç `OrderCreated`.
2. Payment Service –ø–æ–ª—É—á–∞–µ—Ç `OrderCreated`:
   - –ï—Å–ª–∏ `orderId % 2 == 1`: –ø—É–±–ª–∏–∫—É–µ—Ç `PaymentSuccess`.
   - –ï—Å–ª–∏ `orderId % 2 == 0`: –ø—É–±–ª–∏–∫—É–µ—Ç `PaymentFailed`.
3. Order Service —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `PAID` –∏–ª–∏ `CANCELLED`.
4. Shipping Service —Å–ª—É—à–∞–µ—Ç `payments`:
   - –°–æ–∑–¥–∞—ë—Ç –æ—Ç–≥—Ä—É–∑–∫—É ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç `OrderShipped`.
5. Order Service —Å–ª—É—à–∞–µ—Ç `shipments`:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `SHIPPED`.

–ü—Ä–∏–º–µ—Ä –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:
```
Order #1 ‚Üí CREATED ‚Üí PAID ‚Üí SHIPPED
Order #2 ‚Üí CREATED ‚Üí CANCELLED
```

---

